<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>
<filter owl.data>
  @type record_transformer
  enable_ruby
  auto_typecast true
  <record>
    endpoint ${record["message"]["endpoint"]}
    counter ${record["message"]["metric"]}
    value ${record["message"]["value"].to_f}
    timestamp ${record["message"]["time"]}
    metric_tags ${record["message"]["tags"].to_json}
  </record>
</filter>
<match owl.data>
  @type copy
  <store>
    @type riemann
    host 192.168.186.191
    timeout 5
    protocol tcp
    fields endpoint:host,counter:service,timestamp:time,value:metric,metric_tags:map
    types metric:float
    flush_interval 5s
  </store>
  <store>
    @type file
    path ./tmp
    time_slice_format %Y%m%d
    time_slice_wait 10m
    time_format test_out
    compress gzip
    utc
  </store>
</match>
